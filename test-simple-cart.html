<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Agregar al Carrito</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .product-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn:disabled { background: #6c757d; cursor: not-allowed; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; margin: 10px 0; max-height: 300px; overflow-y: auto; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px; border-radius: 5px; z-index: 1000; transform: translateX(100%); transition: transform 0.3s; }
        .notification.show { transform: translateX(0); }
        .notification.success { background: #28a745; color: white; }
        .notification.error { background: #dc3545; color: white; }
        .cart-info { background: #e9ecef; padding: 15px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí Test Simple - Agregar al Carrito</h1>
        
        <div class="cart-info">
            <h3>Estado del Carrito</h3>
            <p id="cart-status">Inicializando...</p>
            <button onclick="showCartInfo()" class="btn">Actualizar Estado</button>
            <button onclick="clearCart()" class="btn">Limpiar Carrito</button>
        </div>

        <h3>Productos de Prueba</h3>
        
        <div class="product-card">
            <h4>Silla de Oficina</h4>
            <p>Precio: $150,000</p>
            <button onclick="testAddToCart('chair1')" class="btn">Agregar al Carrito</button>
        </div>

        <div class="product-card">
            <h4>Silla Gamer</h4>
            <p>Precio: $250,000</p>
            <button onclick="testAddToCart('chair2')" class="btn">Agregar al Carrito</button>
        </div>

        <h3>Log de Actividades</h3>
        <div id="activity-log" class="log">Iniciando test...\n</div>
    </div>

    <script>
        // Mock ProductManager simple
        const mockProducts = {
            'chair1': { id: 'chair1', name: 'Silla de Oficina', price: 150000, stock: 10, image: 'recursos/lunilogo.png', available: true },
            'chair2': { id: 'chair2', name: 'Silla Gamer', price: 250000, stock: 5, image: 'recursos/lunilogo.png', available: true }
        };

        const productManager = {
            initialized: false,
            async initialize() {
                this.initialized = true;
                log('‚úÖ ProductManager inicializado');
                return true;
            },
            getProduct(id) {
                return mockProducts[id] || null;
            },
            checkAvailability(id, quantity) {
                const product = mockProducts[id];
                return product && product.stock >= quantity;
            }
        };

        function log(message) {
            const logElement = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `${timestamp} - ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        async function testAddToCart(productId) {
            log(`üõí Intentando agregar al carrito: ${productId}`);
            
            try {
                // Verificar que cart est√© disponible
                if (typeof cart === 'undefined') {
                    log('‚ùå Cart no est√° definido');
                    showNotification('Sistema de carrito no disponible', 'error');
                    return;
                }

                await productManager.initialize();
                const product = productManager.getProduct(productId);
                if (!product) {
                    log(`‚ùå Producto no encontrado: ${productId}`);
                    showNotification('Producto no encontrado', 'error');
                    return;
                }

                log(`üì¶ Producto encontrado: ${product.name}`);

                const result = cart.addItem(productId, 1);
                log(`üõí Resultado de agregar al carrito: ${JSON.stringify(result)}`);
                
                if (result.success) {
                    showNotification(result.message, 'success');
                    showCartInfo();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                log(`‚ùå Error en testAddToCart: ${error.message}`);
                showNotification('Error al agregar el producto', 'error');
            }
        }

        function showCartInfo() {
            try {
                if (typeof cart === 'undefined') {
                    document.getElementById('cart-status').textContent = 'Cart no disponible';
                    return;
                }

                const items = cart.getItems();
                const total = cart.getTotal();
                const count = cart.getItemCount();
                
                let status = `Productos: ${items.length} | Total: $${total.toLocaleString('es-CO')} | Cantidad: ${count}`;
                
                if (items.length > 0) {
                    status += '\n\nDetalles:\n';
                    items.forEach((item, index) => {
                        status += `${index + 1}. ${item.product ? item.product.name : 'Producto desconocido'} x${item.quantity}\n`;
                    });
                }
                
                document.getElementById('cart-status').textContent = status;
                log(`üìä Estado actualizado: ${count} productos, $${total.toLocaleString('es-CO')}`);
            } catch (error) {
                document.getElementById('cart-status').textContent = `Error: ${error.message}`;
                log(`‚ùå Error obteniendo estado del carrito: ${error.message}`);
            }
        }

        function clearCart() {
            try {
                if (typeof cart !== 'undefined') {
                    cart.clear();
                    showCartInfo();
                    log('üóëÔ∏è Carrito limpiado');
                    showNotification('Carrito limpiado', 'success');
                } else {
                    log('‚ùå Cart no disponible para limpiar');
                }
            } catch (error) {
                log(`‚ùå Error limpiando carrito: ${error.message}`);
            }
        }

        // Inicializar cuando se cargue la p√°gina
        window.onload = function() {
            log('üöÄ P√°gina cargada, verificando dependencias...');
            
            // Verificar si cart.js est√° disponible
            if (typeof cart !== 'undefined') {
                log('‚úÖ Cart est√° disponible');
                showCartInfo();
            } else {
                log('‚ö†Ô∏è Cart no est√° disponible, intentando cargar...');
                
                const script = document.createElement('script');
                script.src = 'js/cart.js';
                script.onload = () => {
                    log('‚úÖ cart.js cargado exitosamente');
                    setTimeout(() => {
                        if (typeof cart !== 'undefined') {
                            log('‚úÖ Variable cart ahora disponible');
                            showCartInfo();
                        } else {
                            log('‚ùå Variable cart a√∫n no disponible despu√©s de cargar el script');
                        }
                    }, 100);
                };
                script.onerror = () => {
                    log('‚ùå Error cargando cart.js');
                };
                document.head.appendChild(script);
            }
        };
    </script>
</body>
</html>