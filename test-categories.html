<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test CategorÃ­as - Luni Hair Clips</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        #results {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Test de Funcionalidad de CategorÃ­as</h1>
    <p>Esta pÃ¡gina permite verificar que el sistema de categorÃ­as funciona correctamente.</p>

    <div class="test-section">
        <h3>1. Verificar ConexiÃ³n con Supabase</h3>
        <button onclick="testSupabaseConnection()">ğŸ”— Test ConexiÃ³n</button>
    </div>

    <div class="test-section">
        <h3>2. Cargar CategorÃ­as Existentes</h3>
        <button onclick="testLoadCategories()">ğŸ“ Cargar CategorÃ­as</button>
    </div>

    <div class="test-section">
        <h3>3. Crear CategorÃ­a de Prueba</h3>
        <button onclick="testCreateCategory()">â• Crear CategorÃ­a Test</button>
    </div>

    <div class="test-section">
        <h3>4. Verificar Funciones de Admin Panel</h3>
        <button onclick="testAdminPanelFunctions()">ğŸ”§ Test Admin Panel</button>
    </div>

    <div class="test-section">
        <h3>5. Simular Click en Botones de CategorÃ­a</h3>
        <button onclick="testCategoryButtons()">ğŸ–±ï¸ Test Botones</button>
    </div>

    <div id="results">
        <p>Los resultados de las pruebas aparecerÃ¡n aquÃ­...</p>
    </div>

    <!-- Scripts del sistema -->
    <script src="js/env-config.js"></script>
    <script src="js/supabaseClient.js"></script>
    <script src="js/categories.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/main.js"></script>

    <script>
        let output = document.getElementById('results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            output.innerHTML = '<p><strong>Iniciando pruebas...</strong></p>';
        }

        async function testSupabaseConnection() {
            clearLog();
            log('ğŸ”„ Verificando conexiÃ³n con Supabase...');
            
            try {
                if (typeof supabase === 'undefined') {
                    log('âŒ ERROR: supabase no estÃ¡ definido', 'error');
                    return;
                }
                
                log('âœ… supabase estÃ¡ disponible', 'success');
                
                // Test de conexiÃ³n bÃ¡sica
                const { data, error } = await supabase.from('categories').select('count');
                
                if (error) {
                    log(`âŒ Error conectando a la tabla categories: ${error.message}`, 'error');
                } else {
                    log('âœ… ConexiÃ³n con tabla categories exitosa', 'success');
                }
                
            } catch (error) {
                log(`âŒ Error en test de conexiÃ³n: ${error.message}`, 'error');
            }
        }

        async function testLoadCategories() {
            clearLog();
            log('ğŸ“ Probando carga de categorÃ­as...');
            
            try {
                if (typeof categoryManager === 'undefined') {
                    log('âŒ ERROR: categoryManager no estÃ¡ definido', 'error');
                    return;
                }
                
                log('âœ… categoryManager estÃ¡ disponible', 'success');
                
                await categoryManager.initialize();
                log('âœ… categoryManager inicializado', 'success');
                
                const categories = categoryManager.getCategories();
                log(`ğŸ“Š CategorÃ­as encontradas: ${categories.length}`, categories.length > 0 ? 'success' : 'warning');
                
                categories.forEach((cat, index) => {
                    log(`${index + 1}. ${cat.icon || 'ğŸ“'} ${cat.name} (${cat.slug}) - ${cat.active ? 'Activa' : 'Inactiva'}`);
                });
                
            } catch (error) {
                log(`âŒ Error cargando categorÃ­as: ${error.message}`, 'error');
            }
        }

        async function testCreateCategory() {
            clearLog();
            log('â• Probando creaciÃ³n de categorÃ­a...');
            
            try {
                await categoryManager.initialize();
                
                const testCategory = {
                    name: `Test Category ${Date.now()}`,
                    slug: `test-category-${Date.now()}`,
                    icon: 'ğŸ§ª',
                    active: true
                };
                
                log(`Creando categorÃ­a: ${testCategory.name}`);
                
                const result = await categoryManager.addCategory(testCategory);
                
                if (result) {
                    log('âœ… CategorÃ­a creada exitosamente', 'success');
                    
                    // Verificar que se creÃ³
                    await categoryManager.initialize();
                    const categories = categoryManager.getCategories();
                    const created = categories.find(cat => cat.slug === testCategory.slug);
                    
                    if (created) {
                        log('âœ… CategorÃ­a encontrada en la base de datos', 'success');
                        log(`ID: ${created.id}, Nombre: ${created.name}`);
                    } else {
                        log('âš ï¸ CategorÃ­a no encontrada despuÃ©s de crear', 'warning');
                    }
                } else {
                    log('âŒ Error al crear categorÃ­a', 'error');
                }
                
            } catch (error) {
                log(`âŒ Error en test de creaciÃ³n: ${error.message}`, 'error');
            }
        }

        async function testAdminPanelFunctions() {
            clearLog();
            log('ğŸ”§ Probando funciones del Admin Panel...');
            
            try {
                if (typeof adminPanel === 'undefined') {
                    log('âŒ ERROR: adminPanel no estÃ¡ definido', 'error');
                    return;
                }
                
                log('âœ… adminPanel estÃ¡ disponible', 'success');
                
                // Verificar funciones crÃ­ticas
                const functions = [
                    'loadCategoriesList',
                    'editCategory', 
                    'deleteCategory',
                    'saveCategory',
                    'showAddCategoryForm'
                ];
                
                functions.forEach(func => {
                    if (typeof adminPanel[func] === 'function') {
                        log(`âœ… FunciÃ³n ${func} estÃ¡ disponible`, 'success');
                    } else {
                        log(`âŒ FunciÃ³n ${func} NO estÃ¡ disponible`, 'error');
                    }
                });
                
            } catch (error) {
                log(`âŒ Error verificando admin panel: ${error.message}`, 'error');
            }
        }

        async function testCategoryButtons() {
            clearLog();
            log('ğŸ–±ï¸ Simulando clicks en botones...');
            
            try {
                // Simular que tenemos categorÃ­as cargadas
                await categoryManager.initialize();
                const categories = categoryManager.getCategories();
                
                if (categories.length === 0) {
                    log('âš ï¸ No hay categorÃ­as para probar botones', 'warning');
                    return;
                }
                
                const testCategory = categories[0];
                log(`Probando con categorÃ­a: ${testCategory.name} (${testCategory.slug})`);
                
                // Test funciÃ³n editar
                log('ğŸ”„ Probando funciÃ³n editCategory...');
                try {
                    // Esto simularÃ­a el click en "Editar"
                    const editTest = adminPanel.editCategory(testCategory.slug);
                    if (editTest instanceof Promise) {
                        await editTest;
                    }
                    log('âœ… FunciÃ³n editCategory ejecutada sin errores', 'success');
                } catch (error) {
                    log(`âŒ Error en editCategory: ${error.message}`, 'error');
                }
                
                // Test funciÃ³n eliminar (sin confirmar)
                log('ğŸ”„ Probando funciÃ³n deleteCategory...');
                try {
                    // Mockear confirm para que retorne false (no eliminar)
                    const originalConfirm = window.confirm;
                    window.confirm = () => false;
                    
                    const deleteTest = adminPanel.deleteCategory(testCategory.slug);
                    if (deleteTest instanceof Promise) {
                        await deleteTest;
                    }
                    log('âœ… FunciÃ³n deleteCategory ejecutada sin errores (cancelada)', 'success');
                    
                    // Restaurar confirm
                    window.confirm = originalConfirm;
                } catch (error) {
                    log(`âŒ Error en deleteCategory: ${error.message}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Error en test de botones: ${error.message}`, 'error');
            }
        }

        // Auto-ejecutar test bÃ¡sico al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸš€ PÃ¡gina de test cargada. Ejecute las pruebas usando los botones.', 'success');
            }, 1000);
        });
    </script>
</body>
</html>